"0","# Creating function to calculate the aggregate demand "
"0","# quantity at a given price, with the output being just quantity, "
"0","# accounting for below-zero values "
"0","aggregate_demand <- function(P){"
"0","  Q1 <- 200 - 0.5*P"
"0","  Q2 <- 5000 - 10*P"
"0","  Q_out = ifelse(Q1 <= 0, 0, Q1)"
"0","  Q = Q_out + Q2"
"0","  return(Q)"
"0","}"
"0",""
"0","# Creating function to calculate the aggregate demand quantity at a "
"0","# given price, with the output being the aggregate quantity, and the "
"0","# quantities of both individual consumers, accounting for below-zero "
"0","# values, for plotting purposes"
"0","aggregate_demand_table <- function(P){"
"0","  Q1 <- 200 - 0.5*P"
"0","  Q2 <- 5000 - 10*P"
"0","  Q_out = ifelse(Q1 <= 0, 0, Q1)"
"0","  Q = Q_out + Q2"
"0","  return(tibble(Q = Q, Q1 = Q_out, Q2 = Q2))"
"0","}"
"0",""
"0","# Writing second supply function which calculates quantity supplied at "
"0","# price, accounting for below-zero values "
"0","supply2 <- function(P){"
"0","  Q1 = 20*P - 100"
"0","  Q = ifelse(Q1 <= 0, 0, Q1)"
"0","  return(Q)"
"0","}"
"0",""
"0","# Creating function to apply to fzero to calculate where they intersect"
"0","aggregate <- function(P){"
"0","  E <- aggregate_demand(P) - supply2(P)"
"0","  return(E)"
"0","}"
"0",""
"0","# Finding equilibrium price at which supply and aggregate traded peanut butter quantities are equal"
"0","aggregate_eq_price <- fzero(function(P) aggregate(P), 100)$x"
"0",""
"0","# plugging aggregate equilibrium price into aggregate demand formula to "
"0","# calculate demand at that price"
"0","aggregate_eq_quantity <- aggregate_demand(aggregate_eq_price)"
"0",""
"0","# sequencing price to both plot and check my work "
"0","P <- seq(from = 0, to = 500, by = 1)"
"0",""
"0","# Putting both demand curves and their agg. value into df, as well as "
"0","# simulated price and supply at each price using my functions, for plotting purposes"
"0","new_demand_df <- aggregate_demand_table(P) %>% "
"0","  mutate(price = P,"
"0","         supply = supply2(P))"
"0",""
"0","# Creating plot of my work"
"0","ggplot(data = new_demand_df) + "
"0","  geom_line(aes(x = Q1, y = price), color = ""blue2"") + "
"0","  geom_line(aes(x = Q2, y = price), color = ""lightblue"") +"
"0","  geom_line(aes(x = Q, y = price), color = ""purple"")  +"
"0","  geom_line(aes(x = supply, y = price), color = ""forestgreen"") + "
"0","  geom_segment(aes(x = 3375, xend = 3375, y = 0, yend = 173.77), color=""red"", linetype = ""dotted"") +"
"0","  geom_segment(aes(x = 0, xend = 3375, y = 173.77, yend = 173.77), color=""red"", linetype = ""dotted"") +"
"0","  geom_text(aes(x = 1, y = 300), label = ""New Demand"", size = 3, color = ""blue"", hjust = -0.2) +"
"0","  geom_text(aes(x = 3500, y = 10), label = ""Old Demand"", size = 3, color = ""lightblue"", hjust = 0) +"
"0","  geom_text(aes(x = 5100, y = 10), label = ""Aggregate Demand"", size = 3, color = ""purple"", hjust = -0.2) +"
"0","  geom_text(aes(x = 4800, y = 300), label = ""Supply"", size = 3, color = ""forestgreen"", hjust = -0.2) +"
"0","  geom_text(aes(x = 3375, y = 173), label = ""P* = 173.7, Q* = 3375"", size = 3, color = ""red"", hjust = -0.2) +"
"0","  theme_bw() +"
"0","  labs(y = ""Price"", x = ""Quantity"") + "
"0","  ggtitle(""Supply and Demand Curve for Peanut Butter Market"")"
